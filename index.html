<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archivio Musicale Biagetti</title>
    <script src="database.js"></script>
    <style>
        :root { --blue: #00d4ff; --dark: #121212; --panel: #1e1e1e; }
        body { margin: 0; background: var(--dark); color: white; font-family: sans-serif; display: flex; height: 100vh; overflow: hidden; }
        
        #sidebar { width: 300px; background: var(--panel); border-right: 2px solid var(--blue); display: flex; flex-direction: column; padding: 15px; }
        #playlist { flex: 1; overflow-y: auto; list-style: none; padding: 0; margin: 0; }
        #playlist li { padding: 12px; border-bottom: 1px solid #333; cursor: pointer; font-size: 0.9rem; }
        #playlist li:hover { background: #333; color: var(--blue); }
        #playlist li.active { background: #005bb5; color: white; font-weight: bold; }

        #main { flex: 1; background: #2c2c2c; }
        iframe { width: 100%; height: 100%; border: none; }

        .player-bar { background: #181818; padding: 15px; border-top: 1px solid #444; }
        audio { width: 100%; }
    </style>
</head>
<body>

    <div id="sidebar">
        <h2 style="color:var(--blue); text-align:center;">I MIEI CANTI</h2>
        <ul id="playlist"></ul>
        <div class="player-bar">
            <audio id="player" controls></audio>
        </div>
    </div>

    <div id="main">
        <iframe id="pdfViewer"></iframe>
    </div>

    <script>
        // Questa funzione gira non appena la pagina è pronta
        window.onload = function() {
            const list = document.getElementById('playlist');
            
            // Controlla se il database.js è stato caricato correttamente
            if (typeof listaFile !== 'undefined') {
                listaFile.sort().forEach(nomeFile => {
                    let li = document.createElement('li');
                    // Mostra il nome senza estensione e senza trattini bassi
                    li.innerText = nomeFile.replace(/\.(mp3|mpeg)$/i, "").replace(/_/g, " ");
                    li.onclick = () => carica(nomeFile, li);
                    list.appendChild(li);
                });
            } else {
                alert("Errore: Non trovo la lista nel file database.js");
            }
        };

        function carica(nomeFile, elemento) {
            const player = document.getElementById('player');
            const pdf = document.getElementById('pdfViewer');
            const nomeBase = nomeFile.replace(/\.(mp3|mpeg)$/i, "");

            // Rimuove la selezione dagli altri
            document.querySelectorAll('li').forEach(el => el.classList.remove('active'));
            elemento.classList.add('active');

            // Carica i file da GitHub (sono nella stessa cartella)
            player.src = encodeURI(nomeFile);
            pdf.src = encodeURI(nomeBase + ".pdf");
            player.play();
        }
    </script>
</body>
</html>
